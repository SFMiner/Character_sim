[gd_scene load_steps=6 format=3 uid="uid://bu0chrj1kws1q"]

[ext_resource type="Script" uid="uid://ug1i2y34ai8y" path="res://ui/dialogue_ui.gd" id="1_ui"]
[ext_resource type="Script" uid="uid://4ti116sywcys" path="res://dialogue/character_node.gd" id="2_char"]
[ext_resource type="Script" uid="uid://bgvid2l4modv1" path="res://dialogue/character_profile.gd" id="3_profile"]
[ext_resource type="Resource" path="res://knowledge/npc_memory_archivist_7.tres" id="4_memory"]

[sub_resource type="Resource" id="Resource_profile"]
script = ExtResource("3_profile")
character_name = "Archivist-7"
character_type = "llm"
hedge_intensity = 0.7
forbidden_topics = Array[String](["magic", "sorcery", "spells"])
preferred_skeletons = Array[String](["structured_answer", "llm_refusal", "llm_ack"])

[node name="Main" type="Control"]
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
script = ExtResource("1_ui")
metadata/_edit_horizontal_guides_ = [-77.0]

[node name="ColorRect" type="ColorRect" parent="."]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
color = Color(0.12, 0.12, 0.15, 1)

[node name="VBoxContainer" type="VBoxContainer" parent="."]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
offset_left = 20.0
offset_top = 20.0
offset_right = -20.0
offset_bottom = -20.0
grow_horizontal = 2
grow_vertical = 2
theme_override_constants/separation = 10

[node name="HeaderContainer" type="HBoxContainer" parent="VBoxContainer"]
layout_mode = 2

[node name="CharacterLabel" type="Label" parent="VBoxContainer/HeaderContainer"]
layout_mode = 2
size_flags_horizontal = 3
theme_override_font_sizes/font_size = 18
text = "Talking to: Archivist-7 (llm)"

[node name="TurnLabel" type="Label" parent="VBoxContainer/HeaderContainer"]
layout_mode = 2
theme_override_font_sizes/font_size = 18
text = "Turn: 0"

[node name="MemoryToggle" type="CheckButton" parent="VBoxContainer/HeaderContainer"]
unique_name_in_owner = true
layout_mode = 2
button_pressed = true
text = "Show Character Memories"

[node name="OutputDisplay" type="RichTextLabel" parent="VBoxContainer"]
layout_mode = 2
size_flags_vertical = 3
focus_mode = 2
bbcode_enabled = true
scroll_following = true
selection_enabled = true

[node name="DebugPanel" type="RichTextLabel" parent="VBoxContainer"]
visible = false
custom_minimum_size = Vector2(0, 120)
layout_mode = 2
bbcode_enabled = true

[node name="InputContainer" type="HBoxContainer" parent="VBoxContainer"]
layout_mode = 2

[node name="InputField" type="LineEdit" parent="VBoxContainer/InputContainer"]
layout_mode = 2
size_flags_horizontal = 3
placeholder_text = "Type your message here..."

[node name="SubmitButton" type="Button" parent="VBoxContainer/InputContainer"]
layout_mode = 2
text = "Submit"

[node name="DebugToggle" type="Button" parent="VBoxContainer/InputContainer"]
layout_mode = 2
text = "Debug"

[node name="CharacterNode" type="Node" parent="."]
script = ExtResource("2_char")
profile = SubResource("Resource_profile")
initial_memory = ExtResource("4_memory")

[node name="MemoryPanel" type="PanelContainer" parent="."]
unique_name_in_owner = true
custom_minimum_size = Vector2(0, 220)
layout_mode = 0
offset_left = 14.0
offset_top = 90.0
offset_right = 1126.0
offset_bottom = 586.0

[node name="MemoryVBox" type="VBoxContainer" parent="MemoryPanel"]
layout_mode = 2
theme_override_constants/separation = 6

[node name="MemoryLabel" type="Label" parent="MemoryPanel/MemoryVBox"]
unique_name_in_owner = true
layout_mode = 2
theme_override_font_sizes/font_size = 14
text = "NPC Memory Facts"

[node name="MemoryControls" type="HBoxContainer" parent="MemoryPanel/MemoryVBox"]
layout_mode = 2

[node name="MemoryFilter" type="LineEdit" parent="MemoryPanel/MemoryVBox/MemoryControls"]
layout_mode = 2
size_flags_horizontal = 3
placeholder_text = "Filter by NPC, fact id, certainty, or text..."

[node name="MemorySort" type="OptionButton" parent="MemoryPanel/MemoryVBox/MemoryControls"]
layout_mode = 2

[node name="MemoryAscending" type="CheckButton" parent="MemoryPanel/MemoryVBox/MemoryControls"]
layout_mode = 2
text = "Ascending"

[node name="MemoryRefresh" type="Button" parent="MemoryPanel/MemoryVBox/MemoryControls"]
layout_mode = 2
text = "Refresh"

[node name="MemoryScroll" type="ScrollContainer" parent="MemoryPanel/MemoryVBox"]
custom_minimum_size = Vector2(0, 160)
layout_mode = 2
size_flags_vertical = 3

[node name="MemoryTable" type="Tree" parent="MemoryPanel/MemoryVBox/MemoryScroll"]
layout_mode = 2
size_flags_horizontal = 3
size_flags_vertical = 3
columns = 4

[connection signal="pressed" from="VBoxContainer/InputContainer/DebugToggle" to="." method="toggle_debug"]
